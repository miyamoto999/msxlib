# メモ

## 2025/5/18
### z88dk関連(ここに書くことじゃないような気がするけど(^^;))
dos2のopen()関数でO_APPENDが使えないので、当然fopen()の"a"でのアペンドができない。

## 2025/5/14
### z88dk関連(ここに書くことじゃないような気がするけど(^^;))
- fwrite()でstdoutに出力してもコンソールに表示されないだよなー。fprintf()の方は出力されるけど。

dos2のopen()のO_APPENDに対応してない件もそうだけどどこまで標準Cの動きと同じようになるようにするかな〜。と悩み中。

## 2025/5/11
- iot.lib、vdp.lib以外はmsxlib.libに統合しようかなと思っている。
- CP/M用のcreat()などの関数では128バイトのバッファがあるけど、今回追加したDOS1用のの差し替え関数ではバッファがないので作りかたによってはディスクアクセスが遅くなるかも。

### z88dk関連(ここに書くことじゃないような気がするけど(^^;))
- mktime()で返っているtime_tの値は、結構単純な実装なんでUNIX系のOSでの値と同じにはならない。(はず。※未確認)

それよか、ドキュメント書けよ(^^;)

## 2025/5/6
### z88dk関連(ここに書くことじゃないような気がするけど(^^;))
- dos2でopen()、O_APPENDに対応していないみたい。
これも差し替え関数用意しないといけないかな(^^;)

z88dkでのdos2のwrite()などの関数はほぼファンクションコールをそのまま呼び出しているような感じで、O_APPENDに相当するモードがないので対応していないみたいだ。

## 2025/4/28
### z88dk関連(ここに書くことじゃないような気がするけど(^^;))
creat()、open()、write()、read()、close()の動きを改めて確認してみた。
- dos1でファイルサイズが128バイトの倍数になる
このあたりをなおした差し替え関数を用意しようと思っている。

## 2025/4/27
1日30分でもいいから必ずプログラムをいじるってのをしないといかんな〜

## 2025/4/12
msxvdp_pork()、msxvdp_peek()もアセンブリで書き直なおして、CPU側のメモリを一気に読み書きする関数(msxvdp_read()、msxvdp_write()みたいな？)も追加しようか。これがないとアセンブリで書き直すだけじゃあんまり意味がないと思う。

## 2025/3/13
いろいろかなり変更しそうなのでバックアップ目的で一旦このタイミングでコミットする。

## 2025/3/12
### z88dk関連(ここに書くことじゃないような気がするけど(^^;))
printfの"%f"が使えない件は、-pragma-includeで指定するpragmaファイルに
~~~
#pragma printf="%f"
~~~
のように描くておくと、リンク時に-pragma-define:CLIB_OPT_PRINTF=0x.....というオプションを付けなくてもいい。この方がCLIB_OPT_PRINTFを指定するよりも指定しやすい。"%d"も使えるようにするには"%d %f"と書く。

## 2025/3/8
### z88dk関連(ここに書くことじゃないような気がするけど(^^;))
2025/1/6に書いたprintfの"%f"が使えないのって"lib/crt/classic/crt_runtime_selection.inc"に書いてあるようにリンク時に-pragma-define:CLIB_OPT_PRINTF=0x.....というオプションを付ければいい。

DOS2でcreat()、open()、write()するとエラーになるんだよね〜。z88dkのソースみるとcreat()でリードオンリーで開いてるっぽい。また直してプルリクエストださんといかんな〜。要調査(^^;)

DOS2のリダイレクションがきかない(^^;) z88dkのputcharだったかは1文字出力のBIOSをよんでるからそのせいかもしれない。要調査(^^;)

z88dk、わからんとことかいろいろあるなー

### msxlib関連
HMMCコマンドを呼び出す関数をC言語ベースで実装したけど、アセンブラ中心で書くと速くなるかもしれない。z88dk関連で書いたようにいろいろあるんで、その前にopen()、read()などの代わりのものを実装しようかと思う。

## 2025/1/8
2025/1/6に関係ないけど、と書いた問題は浮動小数点演算の処理でZ80の未定義命令が使用されていて、Z80エミュレータで未定義命令の実装はしていたけれどバグっていたという結果。

## 2025/1/6
zccでソースコードからオブジェクトを作ってリンクして実行ファイルを生成すると、printf()で"%f"が使えない。
ソースコードから直接実行ファイルを生成すると、printf()で"%f"が使える。
どうすればいいんだろう。

関係ないが未公開のZ80エミュレータで浮動小数点演算を使用しているプログラムが実行できないことがわかった(^^;)